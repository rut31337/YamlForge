---
yamlforge:
  cloud_workspace:
    name: ibm-vpc-comprehensive
    description: IBM VPC comprehensive deployment example
  instances:
  - name: ibm-web-server-1
    provider: ibm_vpc
    size: medium
    image: RHEL9-latest
    region: us-south
    zone: us-south-1
    subnet: web-subnet
    security_groups:
    - web-sg
  - name: ibm-web-server-2
    provider: ibm_vpc
    size: medium
    image: RHEL9-latest
    region: us-south
    zone: us-south-2
    subnet: web-subnet
    security_groups:
    - web-sg
  - name: ibm-app-server-1
    provider: ibm_vpc
    size: large
    image: RHEL9-latest
    region: us-south
    zone: us-south-2
    subnet: app-subnet
    security_groups:
    - app-sg
  - name: ibm-app-server-2
    provider: ibm_vpc
    size: large
    image: RHEL9-latest
    region: us-south
    zone: us-south-3
    subnet: app-subnet
    security_groups:
    - app-sg
  - name: ibm-database-primary
    provider: ibm_vpc
    cores: 8
    memory: 32768
    image: RHEL9-latest
    region: us-south
    zone: us-south-3
    subnet: data-subnet
    security_groups:
    - data-sg
  - name: ibm-database-replica
    provider: ibm_vpc
    cores: 8
    memory: 32768
    image: RHEL9-latest
    region: us-south
    zone: us-south-1
    subnet: data-subnet
    security_groups:
    - data-sg
  security_groups:
    web-sg:
      description: Web tier security group
      rules:
      - protocol: tcp
        port: 80
        source: 0.0.0.0/0
      - protocol: tcp
        port: 443
        source: 0.0.0.0/0
      - protocol: tcp
        port: 22
        source: 10.240.0.0/16
    app-sg:
      description: Application tier security group
      rules:
      - protocol: tcp
        port: 8080
        source: 10.240.1.0/24
      - protocol: tcp
        port: 8443
        source: 10.240.1.0/24
      - protocol: tcp
        port: 22
        source: 10.240.0.0/16
    data-sg:
      description: Database tier security group
      rules:
      - protocol: tcp
        port: 3306
        source: 10.240.2.0/24
      - protocol: tcp
        port: 5432
        source: 10.240.2.0/24
      - protocol: tcp
        port: 22
        source: 10.240.0.0/16
  tags:
    cloud_provider: ibm_vpc
    architecture: three_tier
    high_availability: enabled
    multi_zone: 'true'
    environment: production
